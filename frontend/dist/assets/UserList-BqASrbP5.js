import{d as b,k as I,n as ce,m as we,c as S,o as d,w as o,a as t,a8 as V,aa as p,f as s,g as N,h as g,a7 as h,t as v,ad as ae,i as Re,j as L,W as B,a9 as W,ae as E,af as Pe}from"./index--cwzPgFN.js";import{u as Ce,b as K,c as T,d as ie,e as fe,a as Ue}from"./useMobileDetection-DVtk2gMU.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as D}from"./VGrid-Bvk_EzwB.js";import{V as De}from"./VForm-Dx6NHo9p.js";import{V as ne,a as f,b as $}from"./VTextField-oy8GBoI6.js";import{V as se,a as ve,c as be}from"./VSwitch-DeZFYIz0.js";import{V as ye}from"./VChip-hM0WfqDl.js";import{V as xe}from"./VDialog-BMR7tClG.js";import{V as he}from"./VAlert-Conwkj8S.js";import{c as Ne}from"./index-BvfS-qSn.js";const me=Ne("v-spacer","div","VSpacer"),Me={class:"px-6 pt-6 pb-2 d-flex align-center justify-space-between"},ze={class:"d-flex align-center"},Oe={class:"header-icon-box mr-3"},$e={class:"text-h6 font-weight-bold text-grey-darken-3",style:{"line-height":"1.2"}},Le={key:0,class:"text-caption text-primary ml-2"},je={key:1,class:"text-caption text-grey ml-2"},Be={class:"text-caption text-grey mt-1"},Te={class:"d-flex align-center justify-space-between"},qe={class:"d-flex align-center mb-2"},Fe={key:0,class:"d-flex flex-wrap gap-1 mt-1"},Ge={class:"px-5 py-4 d-flex align-center justify-space-between border-bottom"},_e={class:"d-flex align-center"},He={class:"d-flex align-center"},Je={class:"text-caption text-grey mr-4"},We={class:"px-4 py-3 bg-white d-flex align-center justify-space-between"},Ke={class:"d-flex align-center text-indigo-darken-1 font-weight-bold text-subtitle-2"},Qe={class:"px-4 pb-3 pt-0"},Xe={key:0,class:"text-caption font-weight-bold text-grey-darken-1 mb-2 mt-2 pl-1"},Ye={class:"text-body-2 text-grey-darken-2",style:{"line-height":"1.2"}},Ze={class:"d-flex align-center"},el={__name:"UserForm",props:{modelValue:Boolean,user:Object,clientMode:Boolean,allowedRoles:Array},emits:["update:modelValue","save"],setup(w,{emit:re}){const y=w,Q=re,{isMobileApp:c}=Ce(),X=b([]),q=b([]),F=b([]),G=b([]),k=b([]),C=b([]),z=b([]),j=b(null),M=I({get:()=>y.modelValue,set:i=>Q("update:modelValue",i)}),de=i=>{const e=C.value.find(l=>l.Id===i);return e?e.Descripcion:"Desconocido"},a=b({Documento:"",Nombre:"",Apellido:"",Correo:"",Celular:"",CargoId:null,AreaId:null,SedeId:null,RolId:null,PermisosEspecificos:[],EsUsuarioSistema:!1,Password:"",Activo:!0}),_=b(!1),R=b(!1),Y=I(()=>a.value.EsUsuarioSistema?y.user&&!a.value.Password?[]:[i=>!!i||"Requerida"]:[]);async function Z(){try{const[i,e,l,m,x,J]=await Promise.all([E.get("/api/config/roles",{withCredentials:!0}),E.get("/api/config/permissions",{withCredentials:!0}),E.get("/api/config/sedes",{withCredentials:!0}),E.get("/api/config/catalogs/cargos",{withCredentials:!0}),E.get("/api/config/catalogs/areas",{withCredentials:!0}),E.get("/api/config/companies",{withCredentials:!0})]);k.value=i.data,C.value=e.data;const O={};C.value.forEach(P=>{const A=P.Modulo||"Otros",U=P.SubModulo||"General";O[A]||(O[A]={}),O[A][U]||(O[A][U]=[]),O[A][U].push(P)});const Se={"Seguridad y Acceso":"mdi-lock-outline","Navegación / Menú Principal":"mdi-view-grid-outline","Panel: Configuración del Sistema":"mdi-server","Panel: Configuración Cliente":"mdi-account-cog-outline","Inventario y Dashboard":"mdi-package-variant","Ficha de Equipo (Detalle)":"mdi-wrench-outline",Otros:"mdi-shield-star-outline"},ge=["Navegación / Menú Principal","Panel: Configuración del Sistema","Panel: Configuración Cliente","Inventario y Dashboard","Ficha de Equipo (Detalle)","Seguridad y Acceso"];z.value=Object.keys(O).sort((P,A)=>{const U=ge.indexOf(P),te=ge.indexOf(A);return(U===-1?999:U)-(te===-1?999:te)}).map(P=>{const A=O[P],U=Object.keys(A).sort().map(oe=>({name:oe,permissions:A[oe]})),te=U.flatMap(oe=>oe.permissions);return{name:P,icon:Se[P]||"mdi-circle-small",submodules:U,allPermissions:te}}),q.value=l.data,F.value=m.data,G.value=x.data,X.value=J.data}catch(i){console.error(i)}}const ue=I(()=>q.value.filter(i=>{if(!i.Activo)return!1;const e=X.value.find(x=>x.Id==i.EmpresaId);if(!e)return console.warn(`Sede ${i.NombreSede} has no company (Id: ${i.EmpresaId})`),!1;const l=e.Activo;return(y.clientMode?e.EsCliente:!e.EsCliente)&&l})),u=I(()=>y.allowedRoles.length===0?k.value:k.value.filter(i=>y.allowedRoles.includes(i.Nombre))),n=I(()=>y.allowedRoles.length>0&&y.allowedRoles.some(i=>i.includes("CLIENTE"))),r=I(()=>{if(!n.value)return z.value;const i=["Navegación / Menú Principal","Panel: Configuración Cliente","Inventario y Dashboard","Ficha de Equipo (Detalle)"],e=["Ver Configuración del Sistema","Ver Dashboard Global (Todos)","Ver Inventario Global"];return z.value.filter(l=>i.includes(l.name)).map(l=>{const m={...l};return m.submodules=l.submodules.map(x=>({...x,permissions:x.permissions.filter(J=>!e.includes(J.Descripcion))})).filter(x=>x.permissions.length>0),m.allPermissions=m.submodules.flatMap(x=>x.permissions),m}).filter(l=>l.allPermissions.length>0)}),H=i=>{const e=C.value.find(l=>l.Codigo===i);return e?e.Id:null},ee=i=>{const e=H("menu:view_sys_config"),l=H("menu:view_client_config");if(!e||!l)return!1;const m=a.value.PermisosEspecificos.includes(e),x=a.value.PermisosEspecificos.includes(l);return i==="Panel: Configuración del Sistema"?!m:i==="Panel: Configuración Cliente"?!x:!1},ke=I(()=>a.value.PermisosEspecificos.length),Ae=(i,e)=>{if(le.value||ee(i.name))return;const l=i.allPermissions.map(m=>m.Id);e?l.forEach(m=>{a.value.PermisosEspecificos.includes(m)||a.value.PermisosEspecificos.push(m)}):a.value.PermisosEspecificos=a.value.PermisosEspecificos.filter(m=>!l.includes(m))},Ie=i=>i.allPermissions.length?i.allPermissions.every(e=>a.value.PermisosEspecificos.includes(e.Id)):!1,le=I(()=>{const i=k.value.find(e=>e.Id===a.value.RolId);return i&&i.Nombre==="SUPER ADMINISTRADOR"}),Ee=i=>{const e=k.value.find(l=>l.Id===i);e&&(e.Nombre==="SUPER ADMINISTRADOR"?a.value.PermisosEspecificos=C.value.map(l=>l.Id):e.Permisos?a.value.PermisosEspecificos=[...e.Permisos]:a.value.PermisosEspecificos=[])};async function pe(){const{valid:i}=await j.value.validate();if(i){_.value=!0;try{const e=y.user?`/api/config/users/${y.user.Id}`:"/api/config/users",l=y.user?"put":"post";await E[l](e,a.value,{withCredentials:!0}),Q("save"),M.value=!1}catch(e){console.error(e),alert("Error al guardar: "+(e.response?.data?.message||e.message))}finally{_.value=!1}}}return ce(()=>y.user,i=>{i?a.value={...i,Password:"",EsUsuarioSistema:!!i.RolId}:a.value={Documento:"",Nombre:"",Apellido:"",Correo:"",Celular:"",CargoId:null,AreaId:null,SedeId:null,RolId:null,EsUsuarioSistema:!1,Password:"",Activo:!0}}),ce(()=>y.modelValue,i=>{i&&Z()}),we(()=>{Z()}),(i,e)=>(d(),S(xe,{modelValue:M.value,"onUpdate:modelValue":e[19]||(e[19]=l=>M.value=l),"max-width":p(c)?"100%":"600",fullscreen:p(c),transition:p(c)?"dialog-bottom-transition":"dialog-transition",persistent:""},{default:o(()=>[t(K,{class:V(["rounded-xl elevation-0",{"rounded-0":p(c)}])},{default:o(()=>[s("div",Me,[s("div",ze,[s("div",Oe,[t(N,{color:"primary",size:"24"},{default:o(()=>[...e[20]||(e[20]=[g("mdi-account",-1)])]),_:1})]),s("div",null,[s("h2",$e,[g(v(w.user?"Editar Usuario":"Registrar Usuario")+" ",1),w.clientMode?(d(),h("span",Le,"(Modo Cliente)")):(d(),h("span",je,"(Modo Sistema)"))]),s("p",Be,v(w.user?"Actualizar información":"Nuevo usuario"),1)])]),t(D,{icon:"mdi-close",variant:"text",color:"grey-darken-1",density:"comfortable",onClick:e[0]||(e[0]=l=>M.value=!1)})]),t(T,{class:"mx-6 my-2"}),t(ie,{class:"px-6 py-2 scroll-container",style:ae(p(c)?"height: calc(100vh - 140px); overflow-y: auto;":"max-height: 60vh; overflow-y: auto;")},{default:o(()=>[t(De,{ref_key:"form",ref:j,onSubmit:Re(pe,["prevent"])},{default:o(()=>[t(ne,{dense:""},{default:o(()=>[t(f,{cols:"12"},{default:o(()=>[e[21]||(e[21]=s("label",{class:"text-caption font-weight-bold text-grey-darken-1 mb-1 d-block"},"DOCUMENTO DE IDENTIDAD",-1)),t($,{modelValue:a.value.Documento,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.Documento=l),placeholder:"Ej. 1234567890",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-card-account-details-outline","bg-color":"grey-lighten-5",class:"rounded-lg",rules:[l=>!!l||"Requerido"],"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),t(f,{cols:"12",md:"6"},{default:o(()=>[e[22]||(e[22]=s("label",{class:"text-caption font-weight-bold text-grey-darken-1 mb-1 d-block"},"NOMBRE",-1)),t($,{modelValue:a.value.Nombre,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.Nombre=l),placeholder:"Ej. Juan",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-account-outline","bg-color":"grey-lighten-5",class:"rounded-lg",rules:[l=>!!l||"Requerido"],"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),t(f,{cols:"12",md:"6"},{default:o(()=>[e[23]||(e[23]=s("label",{class:"text-caption font-weight-bold text-grey-darken-1 mb-1 d-block"},"APELLIDO",-1)),t($,{modelValue:a.value.Apellido,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.Apellido=l),placeholder:"Ej. Pérez",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-account-outline","bg-color":"grey-lighten-5",class:"rounded-lg",rules:[l=>!!l||"Requerido"],"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),t(f,{cols:"12",md:"6"},{default:o(()=>[e[24]||(e[24]=s("label",{class:"text-caption font-weight-bold text-grey-darken-1 mb-1 d-block"},"CORREO ELECTRÓNICO",-1)),t($,{modelValue:a.value.Correo,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.Correo=l),placeholder:"juan.perez@empresa.com",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-email-outline","bg-color":"grey-lighten-5",class:"rounded-lg",rules:[l=>!!l||"Requerido",l=>/.+@.+\..+/.test(l)||"Correo inválido"],"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),t(f,{cols:"12",md:"6"},{default:o(()=>[e[25]||(e[25]=s("label",{class:"text-caption font-weight-bold text-grey-darken-1 mb-1 d-block"},"CELULAR",-1)),t($,{modelValue:a.value.Celular,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.Celular=l),placeholder:"(+57) 300 000 0000",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-phone-outline","bg-color":"grey-lighten-5",class:"rounded-lg","hide-details":"auto"},null,8,["modelValue"])]),_:1}),t(f,{cols:"12",md:"6"},{default:o(()=>[e[26]||(e[26]=s("label",{class:"text-caption font-weight-bold text-grey-darken-1 mb-1 d-block"},"CARGO",-1)),t(se,{modelValue:a.value.CargoId,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.CargoId=l),items:F.value,"item-title":"Nombre","item-value":"Id",placeholder:"Seleccionar...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-badge-account-horizontal-outline","bg-color":"grey-lighten-5",class:"rounded-lg","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),t(f,{cols:"12",md:"6"},{default:o(()=>[e[27]||(e[27]=s("label",{class:"text-caption font-weight-bold text-grey-darken-1 mb-1 d-block"},"ÁREA",-1)),t(se,{modelValue:a.value.AreaId,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.AreaId=l),items:G.value,"item-title":"Nombre","item-value":"Id",placeholder:"Seleccionar...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-chart-tree","bg-color":"grey-lighten-5",class:"rounded-lg","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),t(f,{cols:"12"},{default:o(()=>[e[28]||(e[28]=s("label",{class:"text-caption font-weight-bold text-grey-darken-1 mb-1 d-block"},"SEDE ASIGNADA",-1)),t(se,{modelValue:a.value.SedeId,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.SedeId=l),items:ue.value,"item-title":"NombreSede","item-value":"Id",placeholder:"Seleccionar sede...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-map-marker-outline","bg-color":"grey-lighten-5",class:"rounded-lg","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),t(f,{cols:"12"},{default:o(()=>[t(T,{class:"my-2"})]),_:1}),t(f,{cols:"12"},{default:o(()=>[s("div",Te,[e[29]||(e[29]=s("div",null,[s("label",{class:"text-caption font-weight-bold text-grey-darken-1 mb-0 d-block"},"ACCESO AL SISTEMA"),s("span",{class:"text-caption text-grey"},"Habilitar credenciales de acceso")],-1)),t(ve,{modelValue:a.value.EsUsuarioSistema,"onUpdate:modelValue":e[9]||(e[9]=l=>a.value.EsUsuarioSistema=l),color:"primary","hide-details":"",density:"compact",inset:"",class:"scale-switch"},null,8,["modelValue"])])]),_:1}),a.value.EsUsuarioSistema?(d(),h(B,{key:0},[t(f,{cols:"12"},{default:o(()=>[e[30]||(e[30]=s("label",{class:"text-caption font-weight-bold text-grey-darken-1 mb-1 d-block"},"ROL DE USUARIO",-1)),t(se,{modelValue:a.value.RolId,"onUpdate:modelValue":[e[10]||(e[10]=l=>a.value.RolId=l),Ee],items:u.value,"item-title":"Nombre","item-value":"Id",placeholder:"Seleccionar rol...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-shield-account-outline","bg-color":"grey-lighten-5",class:"rounded-lg",rules:[l=>!!l||"Requerido para usuarios de sistema"],"hide-details":"auto"},null,8,["modelValue","items","rules"])]),_:1}),t(f,{cols:"12"},{default:o(()=>[e[32]||(e[32]=s("label",{class:"text-caption font-weight-bold text-grey-darken-1 mb-1 d-block"},"PERMISOS ADICIONALES (GRANULARES)",-1)),s("div",qe,[t(D,{color:"blue-grey-lighten-5",variant:"flat",class:"text-blue-grey-darken-3 text-capitalize rounded-lg flex-grow-1","prepend-icon":"mdi-shield-edit-outline",height:"40",onClick:e[11]||(e[11]=l=>R.value=!0),border:""},{default:o(()=>[...e[31]||(e[31]=[g(" Asignar Permisos Adicionales ",-1)])]),_:1}),a.value.PermisosEspecificos.length>0?(d(),S(ye,{key:0,color:"primary",class:"ml-2 font-weight-bold",size:"large"},{default:o(()=>[g(v(a.value.PermisosEspecificos.length),1)]),_:1})):L("",!0)]),a.value.PermisosEspecificos.length>0?(d(),h("div",Fe,[(d(!0),h(B,null,W(a.value.PermisosEspecificos,l=>(d(),S(ye,{key:l,size:"small",color:"blue-grey",variant:"tonal",class:"mr-1 mb-1"},{default:o(()=>[g(v(de(l)),1)]),_:2},1024))),128))])):L("",!0)]),_:1}),t(xe,{modelValue:R.value,"onUpdate:modelValue":e[15]||(e[15]=l=>R.value=l),"max-width":p(c)?"100%":"900",fullscreen:p(c),transition:p(c)?"dialog-bottom-transition":"dialog-transition",scrollable:""},{default:o(()=>[t(K,{class:V(["rounded-xl bg-white",{"rounded-0":p(c)}])},{default:o(()=>[s("div",Ge,[s("div",_e,[t(N,{color:"primary",class:"mr-2"},{default:o(()=>[...e[33]||(e[33]=[g("mdi-shield-outline",-1)])]),_:1}),e[34]||(e[34]=s("span",{class:"text-h6 font-weight-bold text-grey-darken-3"},"Permisos Granulares",-1))]),s("div",He,[s("span",Je,v(ke.value)+" activos",1),t(D,{icon:"mdi-close",variant:"text",density:"comfortable",color:"grey",onClick:e[12]||(e[12]=l=>R.value=!1)})])]),t(T),t(ie,{class:"px-5 py-5 bg-grey-lighten-5",style:ae(p(c)?"height: calc(100vh - 140px);":"max-height: 75vh;")},{default:o(()=>[t(ne,null,{default:o(()=>[(d(!0),h(B,null,W(r.value,l=>(d(),S(f,{cols:"12",md:"6",key:l.name},{default:o(()=>[t(K,{class:V(["rounded-lg h-100 transition-swing",{"opacity-50":ee(l.name)}]),elevation:"0",border:"",style:{"border-color":"#e0e0e0"}},{default:o(()=>[s("div",We,[s("div",Ke,[t(N,{icon:l.icon,size:"small",class:"mr-2"},null,8,["icon"]),g(" "+v(l.name),1)]),t(be,{"model-value":Ie(l),"onUpdate:modelValue":m=>Ae(l,m),disabled:ee(l.name)||le.value,density:"compact",color:"indigo-lighten-1","hide-details":"",class:"ma-0 pa-0"},null,8,["model-value","onUpdate:modelValue","disabled"])]),s("div",Qe,[(d(!0),h(B,null,W(l.submodules,m=>(d(),h("div",{key:m.name,class:"mb-1"},[m.name!=="General"&&l.submodules.length>1?(d(),h("div",Xe,v(m.name.replace("Sección ","")),1)):L("",!0),(d(!0),h(B,null,W(m.permissions,x=>(d(),h("div",{key:x.Id,class:"d-flex align-center mb-1 permission-row"},[t(be,{modelValue:a.value.PermisosEspecificos,"onUpdate:modelValue":e[13]||(e[13]=J=>a.value.PermisosEspecificos=J),value:x.Id,disabled:ee(l.name)||le.value,density:"compact",color:"indigo-lighten-1","hide-details":"",class:"mr-2"},null,8,["modelValue","value","disabled"]),s("span",Ye,v(x.Descripcion),1)]))),128))]))),128))])]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1}),le.value?(d(),S(he,{key:0,type:"success",variant:"tonal",density:"compact",class:"mt-6 text-caption bg-green-lighten-5 text-green-darken-2",icon:"mdi-shield-check",border:"start",style:{"border-color":"#4CAF50"}},{title:o(()=>[...e[35]||(e[35]=[s("span",{class:"text-green-darken-3 font-weight-bold"},"Acceso Total",-1)])]),default:o(()=>[e[36]||(e[36]=g(' El rol "SUPER ADMINISTRADOR" tiene acceso a todos los permisos del sistema automáticamente. ',-1))]),_:1})):(d(),S(he,{key:1,type:"info",variant:"tonal",density:"compact",class:"mt-6 text-caption bg-blue-lighten-5 text-blue-darken-2",icon:"mdi-information-outline",border:"start",style:{"border-color":"#2196F3"}},{title:o(()=>[...e[37]||(e[37]=[s("span",{class:"text-blue-darken-3 font-weight-bold"},"Modo Personalizado",-1)])]),default:o(()=>[e[38]||(e[38]=g(' Al modificar manualmente cualquier casilla, el rol cambiará automáticamente a "Personalizado". ',-1)),e[39]||(e[39]=s("br",null,null,-1)),e[40]||(e[40]=s("strong",null,"Nota:",-1)),e[41]||(e[41]=g(' Algunas secciones requieren activar permisos de "Navegación" primero. ',-1))]),_:1}))]),_:1},8,["style"]),t(T),t(fe,{class:"px-4 pb-4 pt-2"},{default:o(()=>[t(me),t(D,{color:"primary",variant:"flat",class:"text-capitalize rounded-lg px-6",onClick:e[14]||(e[14]=l=>R.value=!1)},{default:o(()=>[...e[42]||(e[42]=[g(" Listo ",-1)])]),_:1})]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue","max-width","fullscreen","transition"]),t(f,{cols:"12",md:"6"},{default:o(()=>[e[43]||(e[43]=s("label",{class:"text-caption font-weight-bold text-grey-darken-1 mb-1 d-block"},"CONTRASEÑA",-1)),t($,{modelValue:a.value.Password,"onUpdate:modelValue":e[16]||(e[16]=l=>a.value.Password=l),placeholder:w.user?"Dejar en blanco para mantener":"Contraseña",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-lock-outline","bg-color":"grey-lighten-5",class:"rounded-lg",type:"password",rules:Y.value,"hide-details":"auto"},null,8,["modelValue","placeholder","rules"])]),_:1})],64)):L("",!0),t(f,{cols:"12"},{default:o(()=>[t(T,{class:"my-2"})]),_:1}),t(f,{cols:"12"},{default:o(()=>[e[44]||(e[44]=s("label",{class:"text-caption font-weight-bold text-grey-darken-1 mb-1 d-block"},"ESTADO DEL USUARIO",-1)),s("div",{class:V(["status-box d-flex align-center justify-space-between px-3 py-0 rounded-lg",a.value.Activo?"bg-blue-lighten-5":"bg-grey-lighten-4"])},[s("div",Ze,[t(N,{color:a.value.Activo?"primary":"grey",class:"mr-2",size:"16"},{default:o(()=>[g(v(a.value.Activo?"mdi-check-circle":"mdi-minus-circle"),1)]),_:1},8,["color"]),s("span",{class:V(["text-caption font-weight-medium",a.value.Activo?"text-primary":"text-grey-darken-1"])},v(a.value.Activo?"Usuario Activo":"Usuario Inactivo"),3)]),t(ve,{modelValue:a.value.Activo,"onUpdate:modelValue":e[17]||(e[17]=l=>a.value.Activo=l),color:"primary","hide-details":"",density:"compact",inset:"",class:"scale-switch"},null,8,["modelValue"])],2)]),_:1})]),_:1})]),_:1},512)]),_:1},8,["style"]),t(fe,{class:"px-6 pb-6 pt-4 bg-white"},{default:o(()=>[t(me),t(D,{variant:"text",class:"text-capitalize text-grey-darken-1 mr-2",onClick:e[18]||(e[18]=l=>M.value=!1),density:"comfortable"},{default:o(()=>[...e[45]||(e[45]=[g(" Cancelar ",-1)])]),_:1}),t(D,{color:"blue-grey-darken-4",variant:"flat",class:"text-white text-capitalize rounded-lg px-6",height:"40","prepend-icon":"mdi-content-save-outline",onClick:pe,loading:_.value,elevation:"0",density:"comfortable"},{default:o(()=>[g(v(w.user?"Actualizar":"Guardar"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue","max-width","fullscreen","transition"]))}},ll=Ve(el,[["__scopeId","data-v-5bfe4826"]]),tl={key:0,class:"d-flex justify-center align-center py-12"},ol={key:1,class:"d-flex flex-column align-center justify-center py-12 text-center"},sl={class:"d-flex align-center mb-2"},al={class:"text-primary font-weight-bold"},il={class:"text-truncate",style:{flex:"1","min-width":"0"}},nl={class:"text-subtitle-2 font-weight-bold text-grey-darken-3 text-truncate"},rl={class:"text-caption text-grey text-truncate"},dl={class:"text-caption text-grey-darken-1 mb-1 font-weight-medium d-flex align-center"},ul={class:"text-truncate"},cl={key:0,class:"text-caption text-grey mb-1 d-flex align-center"},ml={class:"text-truncate"},pl={key:1,class:"text-caption text-grey d-flex align-center"},gl={class:"text-truncate"},fl={__name:"UserList",props:{modelValue:Boolean,filterRoles:{type:Array,default:()=>[]},title:{type:String,default:"Mis Usuarios"},embedded:{type:Boolean,default:!1},clientMode:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(w,{emit:re}){const y=w,Q=re,{isMobileApp:c}=Ce(),X=I({get:()=>y.modelValue,set:u=>Q("update:modelValue",u)}),q=b([]),F=b([]),G=b([]),k=b(""),C=b(!1),z=b(null),j=b(!1),M=I(()=>{let u=q.value;if(y.filterRoles.length>0&&(u=u.filter(r=>y.filterRoles.includes(r.Rol))),!k.value)return u;const n=k.value.toLowerCase();return u.filter(r=>r.Nombre.toLowerCase().includes(n)||r.Apellido.toLowerCase().includes(n)||r.Correo.toLowerCase().includes(n))});function de(u){return`${u.Nombre.charAt(0)}${u.Apellido.charAt(0)}`.toUpperCase()}function a(u,n){{const r=G.value.find(H=>H.Id===n);return r?r.Nombre:"Desconocido"}}function _(u){const n=F.value.find(r=>r.Id===u);return n?n.NombreSede:"Desconocida"}async function R(){j.value=!0;try{const[u,n,r]=await Promise.all([E.get("/api/config/users",{withCredentials:!0}),E.get("/api/config/sedes",{withCredentials:!0}),E.get("/api/config/catalogs/cargos",{withCredentials:!0})]);q.value=u.data,F.value=n.data,G.value=r.data}catch(u){console.error("Error cargando datos:",u)}finally{j.value=!1}}function Y(){z.value=null,C.value=!0}function Z(u){z.value={...u},C.value=!0}async function ue(){await R(),C.value=!1}return ce(X,u=>{u&&R()},{immediate:!0}),we(()=>{R()}),(u,n)=>(d(),S(K,{class:V(["h-100","elevation-0","bg-grey-lighten-5",p(c)?"rounded-0":"rounded-xl"])},{default:o(()=>[s("div",{class:V([p(c)?"px-4 py-3":"px-6 py-4","d-flex justify-space-between align-center bg-white border-b"])},[s("div",null,[s("h2",{class:V([p(c)?"text-subtitle-1":"text-h6","font-weight-bold text-grey-darken-3"])},v(w.title),3),n[3]||(n[3]=s("p",{class:"text-caption text-grey"},"Gestiona el acceso y los permisos de los usuarios.",-1))]),t(D,{icon:"mdi-close",variant:"text",color:"grey",onClick:n[0]||(n[0]=r=>u.$emit("update:modelValue",!1))})],2),t(ie,{class:V([p(c)?"px-3 py-4":"px-4 py-6 px-md-8"])},{default:o(()=>[t(ne,{class:"mb-4 align-center",dense:p(c)},{default:o(()=>[t(f,{cols:"12",md:"5"},{default:o(()=>[t($,{modelValue:k.value,"onUpdate:modelValue":n[1]||(n[1]=r=>k.value=r),"prepend-inner-icon":"mdi-magnify",label:`Buscar en ${w.title}`,variant:"outlined",density:"compact","hide-details":"","bg-color":"white",class:"rounded-lg"},null,8,["modelValue","label"])]),_:1}),p(c)?L("",!0):(d(),S(me,{key:0})),t(f,{cols:"12",md:"auto"},{default:o(()=>[t(D,{color:"#1e293b",block:"",class:"text-white text-capitalize rounded-lg",height:"40","prepend-icon":"mdi-account-plus",elevation:"0",onClick:Y},{default:o(()=>[...n[4]||(n[4]=[g(" Nuevo Usuario ",-1)])]),_:1})]),_:1})]),_:1},8,["dense"]),j.value?(d(),h("div",tl,[t(Pe,{indeterminate:"",color:"primary",size:"64"})])):M.value.length===0?(d(),h("div",ol,[s("div",{class:"empty-state-icon mb-6",style:ae(p(c)?"width: 72px; height: 72px;":"")},[t(N,{size:p(c)?36:48,color:"primary"},{default:o(()=>[...n[5]||(n[5]=[g("mdi-account-off",-1)])]),_:1},8,["size"]),s("div",{class:"plus-badge",style:ae(p(c)?"width: 24px; height: 24px;":"")},[t(N,{size:p(c)?14:16,color:"white"},{default:o(()=>[...n[6]||(n[6]=[g("mdi-plus",-1)])]),_:1},8,["size"])],4)],4),n[8]||(n[8]=s("h3",{class:"text-h6 font-weight-bold text-grey-darken-3 mb-2"},"No se encontraron registros",-1)),n[9]||(n[9]=s("p",{class:"text-body-2 text-grey mb-8",style:{"max-width":"400px"}}," No hay usuarios registrados que coincidan con tu búsqueda. ",-1)),t(D,{color:"primary",variant:"tonal",class:"text-capitalize rounded-lg px-6",height:"44","prepend-icon":"mdi-account-plus",onClick:Y},{default:o(()=>[...n[7]||(n[7]=[g(" Crear nuevo ",-1)])]),_:1})])):(d(),S(ne,{key:2,dense:p(c)},{default:o(()=>[(d(!0),h(B,null,W(M.value,r=>(d(),S(f,{cols:"12",sm:"6",md:"4",lg:"3",key:r.Id},{default:o(()=>[t(K,{hover:"",onClick:H=>Z(r),class:"user-card border-0 elevation-1 h-100 rounded-lg"},{default:o(()=>[s("div",{class:V(["card-status-strip",r.Activo?"bg-success":"bg-grey"])},null,2),t(ie,{class:V(p(c)?"pa-3":"pa-4")},{default:o(()=>[s("div",sl,[t(Ue,{color:"blue-lighten-5",size:"40",class:"mr-3"},{default:o(()=>[s("span",al,v(de(r)),1)]),_:2},1024),s("div",il,[s("div",nl,v(r.Nombre)+" "+v(r.Apellido),1),s("div",rl,v(r.Correo),1)])]),t(T,{class:"mb-2 border-opacity-50"}),s("div",dl,[t(N,{size:"small",start:"",class:"mr-1"},{default:o(()=>[...n[10]||(n[10]=[g("mdi-shield-account",-1)])]),_:1}),s("span",ul,v(r.Rol||"Sin Rol"),1)]),r.CargoId?(d(),h("div",cl,[t(N,{size:"small",start:"",class:"mr-1",color:"grey-lighten-1"},{default:o(()=>[...n[11]||(n[11]=[g("mdi-badge-account-horizontal",-1)])]),_:1}),s("span",ml,v(a("cargos",r.CargoId)),1)])):L("",!0),r.SedeId?(d(),h("div",pl,[t(N,{size:"small",start:"",class:"mr-1",color:"grey-lighten-1"},{default:o(()=>[...n[12]||(n[12]=[g("mdi-map-marker",-1)])]),_:1}),s("span",gl,v(_(r.SedeId)),1)])):L("",!0)]),_:2},1032,["class"])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1},8,["dense"]))]),_:1},8,["class"]),t(ll,{modelValue:C.value,"onUpdate:modelValue":n[2]||(n[2]=r=>C.value=r),user:z.value,"allowed-roles":w.filterRoles,"client-mode":w.clientMode,onSave:ue},null,8,["modelValue","user","allowed-roles","client-mode"])]),_:1},8,["class"]))}},El=Ve(fl,[["__scopeId","data-v-2b48db74"]]);export{El as U,me as V};
