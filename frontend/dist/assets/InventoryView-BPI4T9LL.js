import{e as F,d as V,k as N,m as H,a7 as x,o as u,a as t,c as b,w as o,a8 as v,aa as r,j as z,g as d,h as i,f as s,af as Y,W as M,a9 as T,t as f,i as Z,ae as ee,aX as te,a6 as oe,S as A}from"./index--cwzPgFN.js";import{u as ae,b as D,d as E,c as se,f as le,a as j}from"./useMobileDetection-DVtk2gMU.js";import{V as ie,d as U}from"./VBadge-Dp2W_JNv.js";import{a as I,b as ne,V as R}from"./VTextField-oy8GBoI6.js";import{V as g}from"./VGrid-Bvk_EzwB.js";import{V as re}from"./VChip-hM0WfqDl.js";import{V as de,a as ue,b as me,d as ce}from"./VList-ClXTKyiG.js";import{V as G}from"./VDialog-BMR7tClG.js";import{u as pe}from"./catalogs-CMBpLrMV.js";import{V as fe}from"./VContainer-B_ZFSiXZ.js";import{V as P}from"./VTooltip-g5pwnaZf.js";import"./index-BvfS-qSn.js";const ge={class:"h-100"},ye={key:0},xe={key:0,class:"d-flex justify-center align-center py-12"},ve={key:1,class:"d-flex flex-column align-center justify-center py-16 text-center animate-fade-in"},be={class:"bg-grey-lighten-4 rounded-circle pa-6 mb-4"},he={class:"position-absolute top-0 right-0 mt-4 mr-4 z-10"},we={class:"d-flex align-start gap-4 mb-4"},ke={class:"rounded-xl bg-indigo-lighten-5 text-indigo-darken-1 d-flex align-center justify-center flex-shrink-0",style:{width:"56px",height:"56px"}},Ve={class:"pt-1 pr-12"},Ce={class:"text-subtitle-1 font-weight-bold text-grey-darken-3 line-height-tight mb-1 clamp-2"},_e={class:"text-caption text-grey font-weight-medium d-flex align-center gap-1"},qe={class:"mb-auto"},Se={class:"d-flex align-center gap-2 mb-2 bg-grey-lighten-5 pa-2 rounded-lg"},ze={class:"text-caption font-weight-medium text-grey-darken-2"},De={class:"d-flex align-center gap-2 px-2"},Ee={class:"text-caption text-grey-darken-1"},Ie={class:"d-flex align-center justify-space-between text-corporate-blue group-hover:text-primary transition-colors"},Ne={key:0,class:"text-caption bg-grey-lighten-4 px-2 py-0.5 rounded text-no-wrap"},Be={class:"text-caption text-grey text-wrap"},Le={class:"text-body-2 text-grey-darken-1 mb-4"},$e={class:"d-flex flex-column gap-3 mt-4"},Me={__name:"EquipmentGallery",props:{companyId:{type:[Number,String],required:!0}},setup(B){const y=B,C=F(),{isMobileApp:n}=ae(),h=V(""),_=V(!1),w=V([]),c=V([]),p=V(!1),k=V(!1),m=N(()=>{if(!Array.isArray(w.value))return[];let l=w.value;if(h.value){const e=h.value.toLowerCase();l=l.filter(a=>a.Modelo&&a.Modelo.toString().toLowerCase().includes(e)||a.CodigoEquipo&&a.CodigoEquipo.toString().toLowerCase().includes(e)||a.Serial&&a.Serial.toString().toLowerCase().includes(e)||a.UsuarioNombre&&a.UsuarioNombre.toString().toLowerCase().includes(e))}return l});async function q(){_.value=!0;try{const l=await ee.get("/api/inventory/equipos",{params:{companyId:y.companyId},withCredentials:!0});w.value=Array.isArray(l.data)?l.data:[]}catch(l){console.error("Error loading equipments:",l),w.value=[]}finally{_.value=!1}}async function L(){try{const l=parseInt(y.companyId);if(!isNaN(l)){const e=await U.getDraftsByCompany(l);c.value=Array.isArray(e)?e:[]}}catch(l){console.error("Error loading drafts",l),c.value=[]}}function K(){p.value=!0}function O(l){p.value=!1,C.push({name:"EquipmentCreate",query:{companyId:y.companyId,draftKey:l.key}})}async function W(l){try{await U.deleteDraft(l.key),await L(),c.value.length===0&&(p.value=!1)}catch(e){console.error("Error deleting draft",e)}}function X(){c.value.length>0?k.value=!0:$()}function $(){k.value=!1,C.push({name:"EquipmentCreate",query:{companyId:y.companyId}})}function J(l){C.push({name:"EquipmentDetail",params:{id:l.Id}})}function Q(l){try{const e=l.split("_");if(e.length>=3){const a=parseInt(e[2]);if(!isNaN(a)){const S=new Date(a);return`${S.toLocaleDateString()} ${S.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}}return"Sin fecha"}catch{return"Sin fecha"}}return H(()=>{q(),L()}),(l,e)=>(u(),x("div",ge,[t(R,{class:v(["mb-6 align-center",{"gap-4":r(n)}])},{default:o(()=>[t(I,{cols:"12",md:"6",class:v({"pa-0":r(n)})},{default:o(()=>[t(ne,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),"prepend-inner-icon":"mdi-magnify",label:"Buscar equipo",placeholder:"Código, Serial, Usuario...",variant:"solo-filled",flat:"",density:"comfortable","hide-details":"","bg-color":"white",class:"search-field rounded-xl elevation-1",clearable:""},null,8,["modelValue"])]),_:1},8,["class"]),t(I,{cols:"12",md:"6",class:v(["d-flex",r(n)?"justify-space-between gap-2 pa-0 text-truncate px-1":"justify-end gap-3"])},{default:o(()=>[t(g,{color:"white",variant:"flat",class:v(["text-capitalize rounded-lg border-thin",{"flex-grow-1 px-2":r(n),"mr-2":!r(n)}]),height:"44",onClick:K,"min-width":r(n)?"44":"auto"},{default:o(()=>[t(d,{start:!r(n)},{default:o(()=>[...e[5]||(e[5]=[i("mdi-file-document-edit-outline",-1)])]),_:1},8,["start"]),r(n)?z("",!0):(u(),x("span",ye,"Borradores")),c.value.length>0?(u(),b(ie,{key:1,content:c.value.length,color:"error",inline:"",class:"ml-2"},null,8,["content"])):z("",!0)]),_:1},8,["class","min-width"]),t(g,{color:"primary",class:v(["text-white text-capitalize rounded-lg",{"flex-grow-1 ml-auto":r(n)}]),height:"44",elevation:"2",onClick:X,"min-width":r(n)?"120":"auto"},{default:o(()=>[t(d,{start:""},{default:o(()=>[...e[6]||(e[6]=[i("mdi-plus",-1)])]),_:1}),e[7]||(e[7]=s("span",{class:"d-none d-sm-inline"},"Nuevo Equipo",-1)),e[8]||(e[8]=s("span",{class:"d-inline d-sm-none"},"Nuevo",-1))]),_:1},8,["class","min-width"])]),_:1},8,["class"])]),_:1},8,["class"]),_.value?(u(),x("div",xe,[t(Y,{indeterminate:"",color:"corporate-blue",size:"64",width:"6"})])):m.value.length===0?(u(),x("div",ve,[s("div",be,[t(d,{size:"48",color:"grey-lighten-1"},{default:o(()=>[...e[9]||(e[9]=[i("mdi-laptop-off",-1)])]),_:1})]),e[10]||(e[10]=s("h3",{class:"text-h6 text-grey-darken-3 font-weight-bold mb-1"},"No se encontraron equipos",-1)),e[11]||(e[11]=s("p",{class:"text-body-2 text-grey"},"No hay equipos registrados para esta empresa o búsqueda.",-1))])):(u(),b(R,{key:2,class:"match-height"},{default:o(()=>[(u(!0),x(M,null,T(m.value,a=>(u(),b(I,{cols:"12",sm:"6",md:"4",lg:"3",key:a.Id},{default:o(()=>[t(D,{hover:"",onClick:S=>J(a),class:v(["equipment-card border-0 elevation-0 h-100 rounded-xl d-flex flex-column group",{"mobile-card":r(n)}])},{default:o(()=>[s("div",he,[t(re,{size:"x-small",color:"emerald",class:"bg-green-lighten-5 text-green-darken-2 font-weight-bold border-0",variant:"flat"},{default:o(()=>[...e[12]||(e[12]=[i(" Activo ",-1)])]),_:1})]),t(E,{class:"pa-5 d-flex flex-column h-100 position-relative"},{default:o(()=>[s("div",we,[s("div",ke,[t(d,{size:"32"},{default:o(()=>[...e[13]||(e[13]=[i("mdi-laptop",-1)])]),_:1})]),s("div",Ve,[s("h3",Ce,f(a.Modelo||"Sin Modelo"),1),s("div",_e,[t(d,{size:"12"},{default:o(()=>[...e[14]||(e[14]=[i("mdi-barcode",-1)])]),_:1}),i(" "+f(a.Serial||"S/N"),1)])])]),s("div",qe,[s("div",Se,[t(d,{size:"16",color:"grey-darken-1"},{default:o(()=>[...e[15]||(e[15]=[i("mdi-identifier",-1)])]),_:1}),s("span",ze,f(a.CodigoEquipo),1)]),s("div",De,[t(d,{size:"16",color:"grey-lighten-1"},{default:o(()=>[...e[16]||(e[16]=[i("mdi-account",-1)])]),_:1}),s("span",Ee,f(a.UsuarioNombre||"Sin Asignar"),1)])]),t(se,{class:"my-4 border-dashed"}),s("div",Ie,[e[18]||(e[18]=s("span",{class:"text-caption font-weight-bold text-uppercase tracking-wide"},"Ver Detalles",-1)),t(g,{icon:"",variant:"text",density:"compact",size:"small",class:"ml-2"},{default:o(()=>[t(d,{class:"transform group-hover:translate-x-1 transition-transform"},{default:o(()=>[...e[17]||(e[17]=[i("mdi-arrow-right",-1)])]),_:1})]),_:1})])]),_:2},1024)]),_:2},1032,["onClick","class"])]),_:2},1024))),128))]),_:1})),t(G,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=a=>p.value=a),"max-width":r(n)?"100%":"500",fullscreen:r(n),transition:r(n)?"dialog-bottom-transition":"scale-transition"},{default:o(()=>[t(D,{class:v(["d-flex flex-column",r(n)?"rounded-0":"rounded-xl"])},{default:o(()=>[t(le,{class:"pa-4 d-flex align-center justify-space-between border-b bg-white position-sticky top-0 z-10"},{default:o(()=>[e[19]||(e[19]=s("span",{class:"text-h6 font-weight-bold"},"Borradores Guardados",-1)),t(g,{icon:"mdi-close",variant:"text",density:"comfortable",onClick:e[1]||(e[1]=a=>p.value=!1)})]),_:1}),t(E,{class:"pa-0 flex-grow-1 overflow-y-auto"},{default:o(()=>[t(de,{lines:"two",class:"pa-2"},{default:o(()=>[(u(!0),x(M,null,T(c.value,a=>(u(),b(ue,{key:a.key,value:a.key,onClick:S=>O(a),class:"rounded-lg mb-1",color:"primary"},{prepend:o(()=>[t(j,{color:"blue-lighten-5",class:"text-blue-darken-1"},{default:o(()=>[t(d,{icon:"mdi-file-document-edit-outline"})]),_:1})]),append:o(()=>[t(g,{icon:"mdi-delete-outline",variant:"text",color:"error",density:"comfortable",onClick:Z(S=>W(a),["stop"])},null,8,["onClick"])]),default:o(()=>[t(me,{class:"font-weight-bold message-text"},{default:o(()=>[i(f(a.Modelo||"Nuevo Equipo Sin Modelo"),1)]),_:2},1024),t(ce,{class:"d-flex align-center gap-2 mt-1 flex-wrap"},{default:o(()=>[a.CodigoEquipo?(u(),x("span",Ne,f(a.CodigoEquipo),1)):z("",!0),s("span",Be,f(Q(a.key)),1)]),_:2},1024)]),_:2},1032,["value","onClick"]))),128))]),_:1})]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue","max-width","fullscreen","transition"]),t(G,{modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=a=>k.value=a),"max-width":"400"},{default:o(()=>[t(D,{class:"rounded-xl pa-2"},{default:o(()=>[t(E,{class:"text-center pt-6 pb-2"},{default:o(()=>[t(j,{color:"amber-lighten-5",size:"64",class:"mb-4"},{default:o(()=>[t(d,{size:"32",color:"amber-darken-3"},{default:o(()=>[...e[20]||(e[20]=[i("mdi-clipboard-text-clock-outline",-1)])]),_:1})]),_:1}),e[27]||(e[27]=s("h3",{class:"text-h6 font-weight-bold text-grey-darken-3 mb-2"},"Borradores Encontrados",-1)),s("p",Le,[i(" Tienes "+f(c.value.length)+" borrador(es) pendiente(s). ",1),e[21]||(e[21]=s("br",null,null,-1)),e[22]||(e[22]=i(" ¿Deseas continuarlos o empezar uno nuevo? ",-1))]),s("div",$e,[t(g,{block:"",color:"amber-lighten-5",variant:"flat",class:"text-amber-darken-4 text-capitalize font-weight-bold rounded-lg",height:"48",onClick:e[3]||(e[3]=a=>{k.value=!1,p.value=!0})},{default:o(()=>[t(d,{start:""},{default:o(()=>[...e[23]||(e[23]=[i("mdi-file-eye-outline",-1)])]),_:1}),e[24]||(e[24]=i(" Ver Borradores ",-1))]),_:1}),t(g,{block:"",color:"primary",variant:"flat",class:"text-capitalize font-weight-bold rounded-lg",height:"48",onClick:$},{default:o(()=>[t(d,{start:""},{default:o(()=>[...e[25]||(e[25]=[i("mdi-plus",-1)])]),_:1}),e[26]||(e[26]=i(" Crear Nuevo ",-1))]),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Te={class:"w-100"},Ae={class:"mb-6 mb-md-8"},je={class:"d-flex align-center mb-1"},Ue={class:"text-caption text-grey"},Re={class:"text-h5 text-md-h4 font-weight-bold text-primary mb-1 d-flex align-center"},et={__name:"InventoryView",setup(B){const y=oe(),C=F(),n=pe(),{offlineReady:h,loading:_}=te(n),w=N(()=>y.query.companyId),c=N(()=>y.query.companyName);function p(){C.push({name:"InventoryHome"})}return H(()=>{n.fetchCatalogs(["estadosEquipo","tiposEquipo","fabricantes"])}),(k,m)=>(u(),b(fe,{fluid:"",class:"bg-grey-lighten-5 fill-height align-start"},{default:o(()=>[s("div",Te,[s("div",Ae,[s("div",je,[t(g,{icon:"mdi-arrow-left",variant:"text",size:"small",class:"mr-2",onClick:p}),s("div",Ue,[t(d,{size:"small",class:"mr-1"},{default:o(()=>[...m[0]||(m[0]=[i("mdi-home",-1)])]),_:1}),m[1]||(m[1]=i(" / Inventario / Equipos ",-1))])]),s("h1",Re,[i(f(c.value||"Inventario")+" ",1),r(h)?(u(),b(P,{key:0,location:"bottom"},{activator:o(({props:q})=>[t(d,A(q,{icon:"mdi-cloud-off-outline",color:"grey-lighten-1",size:"small",class:"ml-2"}),null,16)]),default:o(()=>[m[2]||(m[2]=s("span",null,"Modo Offline Listo",-1))]),_:1})):r(_)?(u(),b(P,{key:1,location:"bottom"},{activator:o(({props:q})=>[t(d,A(q,{icon:"mdi-cloud-sync",color:"primary",size:"small",class:"ml-2",style:{animation:"spin 2s linear infinite"}}),null,16)]),default:o(()=>[m[3]||(m[3]=s("span",null,"Descargando datos...",-1))]),_:1})):z("",!0)]),m[4]||(m[4]=s("p",{class:"text-body-2 text-md-body-1 text-grey-darken-1"}," Gestión de equipos y activos asignados. ",-1))]),t(Me,{"company-id":w.value},null,8,["company-id"])])]),_:1}))}};export{et as default};
